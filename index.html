<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trypanosoma brucei Life Cycle Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #0b1020;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      padding: 1.5rem 2rem 1rem;
      background: linear-gradient(135deg, #111827, #1f2937);
      border-bottom: 1px solid #374151;
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.03em;
    }

    header p {
      margin: 0.25rem 0 0;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1.5rem;
      gap: 1rem;
    }

    .mode-switch {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }

    .btn {
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #e5e7eb;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
    }

    .btn:hover {
      background: #1f2937;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
    }

    .btn.active {
      background: #2563eb;
      border-color: #2563eb;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(220px, 280px) minmax(0, 1fr);
      gap: 1rem;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .timeline {
      background: #020617;
      border-radius: 1rem;
      border: 1px solid #111827;
      padding: 0.75rem;
      max-height: 80vh;
      overflow-y: auto;
    }

    .timeline-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    .timeline-sub {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-bottom: 0.75rem;
    }

    .stage-item {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.5rem;
      margin-bottom: 0.35rem;
      border-radius: 0.7rem;
      cursor: pointer;
      transition: background 0.1s ease, border-color 0.1s ease;
      border: 1px solid transparent;
    }

    .stage-item:hover {
      background: #020617;
      border-color: #1f2937;
    }

    .stage-item.active {
      background: #111827;
      border-color: #2563eb;
    }

    .stage-number {
      width: 1.3rem;
      height: 1.3rem;
      border-radius: 999px;
      border: 1px solid #4b5563;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      color: #9ca3af;
      flex-shrink: 0;
    }

    .stage-text {
      font-size: 0.8rem;
    }

    .stage-text strong {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 0.15rem;
    }

    .card {
      background: radial-gradient(circle at top left, #111827, #020617);
      border-radius: 1rem;
      border: 1px solid #1f2937;
      padding: 1rem 1.2rem 1.2rem;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
      min-height: 260px;
    }

    .card h2 {
      margin: 0 0 0.4rem;
      font-size: 1.1rem;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.35rem;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid #4b5563;
      padding: 0.15rem 0.55rem;
      font-size: 0.7rem;
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.8);
    }

    .label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      margin-top: 0.3rem;
    }

    .value {
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    .bullet-list {
      margin: 0.3rem 0 0.4rem;
      padding-left: 1.1rem;
      font-size: 0.8rem;
    }

    .bullet-list li {
      margin-bottom: 0.18rem;
    }

    .flow {
      margin-top: 0.6rem;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .timeline-images {
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid #111827;
    }

    .media-grid {
      margin-top: 0.5rem;
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }

    .media-item {
      background: #020617;
      border-radius: 0.8rem;
      border: 1px solid #111827;
      padding: 0.4rem;
      text-align: center;
    }

    .media-item img {
      max-width: 100%;
      border-radius: 0.6rem;
      display: block;
      margin: 0 auto 0.3rem;
    }

    .media-caption {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .quiz-question {
      margin: 0.3rem 0 0.5rem;
      font-size: 0.95rem;
    }

    .quiz-desc {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 0.45rem;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      margin-bottom: 0.5rem;
    }

    .quiz-option {
      padding: 0.4rem 0.6rem;
      border-radius: 0.6rem;
      border: 1px solid #4b5563;
      cursor: pointer;
      font-size: 0.85rem;
      background: #020617;
      color: #ffffff;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.05s ease;
      text-align: left;
    }

    .quiz-option:hover {
      background: #111827;
      transform: translateY(-1px);
    }

    .quiz-option.correct {
      border-color: #16a34a;
      background: rgba(22, 163, 74, 0.25);
      color: #ffffff;
    }

    .quiz-option.incorrect {
      border-color: #dc2626;
      background: rgba(220, 38, 38, 0.25);
      color: #ffffff;
    }

    .quiz-feedback {
      font-size: 0.8rem;
      margin-bottom: 0.4rem;
      min-height: 1.2em;
    }

    .quiz-feedback.correct {
      color: #4ade80;
    }

    .quiz-feedback.incorrect {
      color: #f97373;
    }

    .quiz-meta {
      font-size: 0.7rem;
      color: #9ca3af;
      margin-top: 0.2rem;
    }

    footer {
      font-size: 0.7rem;
      color: #6b7280;
      padding: 0.75rem 1.5rem 1rem;
      border-top: 1px solid #111827;
      text-align: right;
    }

    .why-section,
    .ecology-section,
    .citations-section {
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .why-section h3,
    .ecology-section h3,
    .citations-section h3 {
      margin-top: 0.7rem;
      margin-bottom: 0.2rem;
      font-size: 0.95rem;
    }

    .why-section p,
    .ecology-section p,
    .citations-section p {
      margin: 0.2rem 0 0.4rem;
    }

    .why-highlight {
      background: rgba(37, 99, 235, 0.18);
      border-radius: 0.75rem;
      border: 1px solid rgba(37, 99, 235, 0.6);
      padding: 0.55rem 0.7rem;
      font-size: 0.8rem;
      margin-bottom: 0.6rem;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.2rem;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid #374151;
      padding: 0.15rem 0.55rem;
      font-size: 0.7rem;
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.9);
    }

    #bs-forms-section {
      margin-top: 0.7rem;
    }

    .bs-forms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.4rem;
      margin-top: 0.3rem;
    }

    .bs-form-card {
      border-radius: 0.7rem;
      border: 1px solid #374151;
      padding: 0.4rem 0.55rem;
      background: rgba(15, 23, 42, 0.9);
      font-size: 0.78rem;
    }

    .bs-form-card strong {
      display: block;
      margin-bottom: 0.15rem;
      font-size: 0.8rem;
    }

    /* GAME: T. brucei Trail */
    .game-section {
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .game-status {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-top: 0.4rem;
      margin-bottom: 0.1rem;
    }

    .game-box {
      margin-top: 0.6rem;
      border-radius: 0.9rem;
      border: 1px solid #374151;
      background: rgba(15, 23, 42, 0.9);
      padding: 0.7rem 0.8rem;
    }

    .game-title {
      font-weight: 600;
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }

    .game-text {
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
    }

    .game-outcome {
      font-size: 0.8rem;
      margin-top: 0.3rem;
      min-height: 1.2em;
      color: #9ca3af;
    }

    .game-options {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-top: 0.4rem;
    }

    .game-meta {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 0.4rem;
    }

    .citations-list {
      font-size: 0.8rem;
      padding-left: 1.1rem;
    }

    .citations-list li {
      margin-bottom: 0.35rem;
    }

    .citations-list a {
      color: #60a5fa;
      text-decoration: none;
      word-break: break-all;
    }

    .citations-list a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
<header>
  <h1>Trypanosoma brucei Life Cycle Explorer</h1>
  <p>Interactive overview of African trypanosomiasis (sleeping sickness): stages, quiz, ecology, and a T. brucei Trail game.</p>
</header>

<main>
  <div class="mode-switch">
    <button id="mode-explore" class="btn active">Explore Life Cycle</button>
    <button id="mode-quiz" class="btn">Quiz</button>
    <button id="mode-game" class="btn">Game: T. brucei Trail</button>
    <button id="mode-why" class="btn">Why It Matters</button>
    <button id="mode-ecology" class="btn">Ecology &amp; Climate</button>
    <button id="mode-citations" class="btn">Works Cited</button>
  </div>

  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="timeline">
      <div class="timeline-title">Life Cycle Timeline</div>
      <div class="timeline-sub">
        Condensed stages of African trypanosomes in the mammalian host and tsetse fly vector.
      </div>
      <div id="stage-list"></div>

      <div class="timeline-images">
        <div class="label">CDC reference images</div>
        <div class="media-grid">
          <div class="media-item">
            <a href="https://www.cdc.gov/dpdx/trypanosomiasisafrican/index.html" target="_blank" rel="noreferrer">
              <img
                src="https://www.cdc.gov/dpdx/trypanosomiasisafrican/modules/SleepingSick_LifeCycle_19.jpg"
                alt="CDC life cycle diagram of African trypanosomiasis"
              />
            </a>
            <div class="media-caption">
              CDC DPDx: African trypanosomiasis life cycle diagram.
            </div>
          </div>
          <div class="media-item">
            <a href="https://www.cdc.gov/dpdx/trypanosomiasisafrican/index.html#Images" target="_blank" rel="noreferrer">
              <img
                src="https://www.cdc.gov/dpdx/trypanosomiasisafrican/images/2/Figure-A.jpg"
                alt="Trypanosoma brucei trypomastigote in a blood smear, CDC DPDx"
              />
            </a>
            <div class="media-caption">
              CDC DPDx: <em>T. brucei</em> trypomastigote in Giemsa-stained blood.
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- PANEL: EXPLORE -->
    <section id="panel-explore" class="card">
      <h2 id="stage-title">Select a stage</h2>
      <div class="pill-row" id="stage-pills"></div>

      <div class="label">Host</div>
      <div class="value" id="stage-host">—</div>

      <div class="label">Anatomical location</div>
      <div class="value" id="stage-location">—</div>

      <div class="label">What happens here?</div>
      <ul class="bullet-list" id="stage-keypoints"></ul>

      <div class="label">Clinical / epidemiological notes</div>
      <ul class="bullet-list" id="stage-notes"></ul>

      <div class="flow" id="stage-flow"></div>

      <div id="bs-forms-section" style="display:none;">
        <div class="label">Bloodstream forms in humans</div>
        <div class="bs-forms-grid">
          <div class="bs-form-card">
            <strong>Slender form</strong>
            Replicating bloodstream trypomastigote. Multiplies rapidly and drives parasitemia,
            using antigenic variation to evade the immune response. Dominant early in infection.
          </div>
          <div class="bs-form-card">
            <strong>Stumpy form</strong>
            Non-dividing, transmission-competent form. More stress-resistant and adapted to survive
            in the tsetse fly midgut after a blood meal. Essential for carrying the life cycle back
            into the vector.
          </div>
        </div>
      </div>
    </section>

    <!-- PANEL: QUIZ -->
    <section id="panel-quiz" class="card" style="display:none;">
      <h2>Quiz</h2>
      <p class="quiz-desc">
        Multiple-choice practice on <em>T. brucei</em>, its vectors, key stages, and high-yield clinical facts.
      </p>
      <div class="quiz-question" id="quiz-question-text"></div>
      <div class="quiz-desc" id="quiz-question-extra"></div>
      <div class="quiz-options" id="quiz-options"></div>
      <div class="quiz-feedback" id="quiz-feedback"></div>

      <button class="btn" id="quiz-next">Next Question</button>
      <div class="quiz-meta" id="quiz-meta"></div>
    </section>

    <!-- PANEL: GAME -->
    <section id="panel-game" class="card" style="display:none;">
      <h2>Game: T. brucei Trail</h2>
      <div class="game-section">
        <p>
          You are a single <em>Trypanosoma brucei</em> parasite trying to complete your life cycle.
          Make biologically correct choices to move from tsetse fly to human and back again.
          Wrong choices break the cycle.
        </p>

        <div class="game-status" id="game-status"></div>

        <div class="game-box">
          <div class="game-title" id="game-state-title"></div>
          <div class="game-text" id="game-state-text"></div>
          <div class="game-options" id="game-options"></div>
          <div class="game-outcome" id="game-outcome"></div>
          <div class="game-meta" id="game-meta"></div>
        </div>
        <button class="btn" id="game-reset" style="margin-top:0.6rem;">Restart T. brucei Trail</button>
      </div>
    </section>

    <!-- PANEL: WHY IT MATTERS -->
    <section id="panel-why" class="card" style="display:none;">
      <h2>Why It Matters</h2>
      <div class="why-section">
        <div class="why-highlight">
          <strong>Without treatment, sleeping sickness is usually fatal.</strong>
          Human African trypanosomiasis is a neglected tropical disease caused by
          <em>Trypanosoma brucei</em>, transmitted by tsetse flies in rural sub-Saharan Africa.
        </div>

        <h3>Human and community burden</h3>
        <p>
          Infection often begins with fever, headache, and lymphadenopathy, and can later progress
          to confusion, behavior changes, and disruption of the sleep–wake cycle when the nervous
          system is involved. Without diagnosis and treatment, people may progress to coma and death.
        </p>
        <ul class="bullet-list">
          <li>Historically caused large epidemics in parts of West, Central, and East Africa.</li>
          <li>Primarily affects remote rural communities where access to care is limited.</li>
          <li>Illness and death reduce productivity, schooling, and economic stability.</li>
          <li>Control programs rely on active surveillance, vector control, and access to treatment.</li>
        </ul>

        <div class="chip-row">
          <span class="chip">Neglected tropical disease</span>
          <span class="chip">Fatal without treatment</span>
          <span class="chip">Rural communities affected</span>
        </div>

        <h3>Where it occurs</h3>
        <p>
          Sleeping sickness is only found in sub-Saharan Africa, in areas where tsetse flies live.
          Two subspecies cause human disease:
        </p>
        <ul class="bullet-list">
          <li>
            <strong><em>T. b. gambiense</em></strong> – West and Central Africa; slower, chronic course and responsible for most reported human cases.
          </li>
          <li>
            <strong><em>T. b. rhodesiense</em></strong> – East and Southeast Africa; faster, acute course and a smaller share of cases.
          </li>
        </ul>

        <h3>Why this app exists</h3>
        <p>
          Typical diagrams show arrows and labels but often stop there. This tool:
        </p>
        <ul class="bullet-list">
          <li>Lets students explore each life-cycle stage in order.</li>
          <li>Links vector and host stages to diagnosis and symptoms described in clinical guidance.</li>
          <li>Uses quiz and game modes to lock in concepts for exams and teaching.</li>
          <li>Connects the classic life cycle to real-world public health questions.</li>
        </ul>
      </div>
    </section>

    <!-- PANEL: ECOLOGY & CLIMATE -->
    <section id="panel-ecology" class="card" style="display:none;">
      <h2>Ecology &amp; Climate: A One Health Parasite</h2>
      <div class="ecology-section">
        <h3>Tsetse habitat and hosts</h3>
        <p>
          Tsetse flies that transmit <em>T. brucei</em> are found in rural areas of sub-Saharan Africa.
          They live in woodlands and thickets in East African savannah and in forests and vegetation along
          streams and rivers in Central and West Africa.
        </p>
        <ul class="bullet-list">
          <li>Flies feed on wild animals, livestock, and humans, linking all three in a transmission network.</li>
          <li>For <em>T. b. gambiense</em>, humans are an important reservoir; for <em>T. b. rhodesiense</em>, cattle and wildlife play major roles.</li>
          <li>Changes in land use (clearing, farming, roads) can shift contact between flies, livestock, wildlife, and people.</li>
        </ul>

        <div class="chip-row">
          <span class="chip">Rural &amp; riverine habitats</span>
          <span class="chip">Wildlife–cattle–human interface</span>
          <span class="chip">One Health system</span>
        </div>

        <h3>Climate and tsetse distributions</h3>
        <p>
          Tsetse flies are sensitive to temperature, humidity, and vegetation cover. Research suggests that as climate changes,
          some areas may become less suitable for tsetse while other areas may become more favorable, especially in regions that
          were previously cooler.
        </p>
        <ul class="bullet-list">
          <li>Hotter, drier conditions can reduce tsetse survival in some lowland habitats.</li>
          <li>Warming at higher elevations may make new areas suitable for tsetse flies and transmission.</li>
          <li>Changes in rainfall and vegetation can reshape the mosaic of habitat where flies and hosts overlap.</li>
        </ul>

        <h3>Ecology in the classroom</h3>
        <p>
          Sleeping sickness shows how a parasite is embedded in an environmental system:
        </p>
        <ul class="bullet-list">
          <li>Parasite traits (slender vs stumpy forms) are tuned to vector and host biology.</li>
          <li>Vector ecology depends on climate, vegetation, and host availability.</li>
          <li>Human behavior (farming, herding, fishing, hunting) changes exposure and control options.</li>
        </ul>
        <p>
          This tab is built to push users past memorizing the life cycle into thinking about
          parasite + vector + environment + climate + people as one system.
        </p>
      </div>
    </section>

    <!-- PANEL: WORKS CITED -->
    <section id="panel-citations" class="card" style="display:none;">
      <h2>Works Cited</h2>
      <div class="citations-section">
        <p>
          Content in this app is based on authoritative sources. Key references are listed for documentation
          and further reading.
        </p>

        <h3>CDC – Sleeping Sickness / Human African Trypanosomiasis</h3>
        <ul class="citations-list">
          <li>
            Centers for Disease Control and Prevention (CDC). <em>Sleeping Sickness (African Trypanosomiasis) – About.</em>
            Available at:
            <a href="https://www.cdc.gov/sleeping-sickness/about/index.html" target="_blank" rel="noreferrer">
              https://www.cdc.gov/sleeping-sickness/about/index.html
            </a>
          </li>
          <li>
            CDC. <em>Sleeping Sickness – Causes.</em> Parasite subspecies, geography, and tsetse habitats.
            <a href="https://www.cdc.gov/sleeping-sickness/causes/index.html" target="_blank" rel="noreferrer">
              https://www.cdc.gov/sleeping-sickness/causes/index.html
            </a>
          </li>
          <li>
            CDC. <em>Sleeping Sickness – Prevention.</em>
            <a href="https://www.cdc.gov/sleeping-sickness/prevention/index.html" target="_blank" rel="noreferrer">
              https://www.cdc.gov/sleeping-sickness/prevention/index.html
            </a>
          </li>
          <li>
            CDC. <em>Clinical Guidance for Human African Trypanosomiasis.</em>
            <a href="https://www.cdc.gov/sleeping-sickness/hcp/clinical-guidance/index.html" target="_blank" rel="noreferrer">
              https://www.cdc.gov/sleeping-sickness/hcp/clinical-guidance/index.html
            </a>
          </li>
          <li>
            CDC. <em>Clinical Care of Human African Trypanosomiasis.</em>
            <a href="https://www.cdc.gov/sleeping-sickness/hcp/clinical-care/index.html" target="_blank" rel="noreferrer">
              https://www.cdc.gov/sleeping-sickness/hcp/clinical-care/index.html
            </a>
          </li>
        </ul>

        <h3>CDC – DPDx Parasitology (Life Cycle & Morphology)</h3>
        <ul class="citations-list">
          <li>
            CDC Division of Parasitic Diseases and Malaria. <em>DPDx – Trypanosomiasis, African.</em>
            Life cycle, diagnostic stages, and images.
            <a href="https://www.cdc.gov/dpdx/trypanosomiasisafrican/index.html" target="_blank" rel="noreferrer">
              https://www.cdc.gov/dpdx/trypanosomiasisafrican/index.html
            </a>
          </li>
          <li>
            CDC DPDx. <em>Case #514 – April 2020.</em> African trypanosomiasis blood smear images and discussion.
            <a href="https://www.cdc.gov/dpdx/monthlycasestudies/2020/case514.html" target="_blank" rel="noreferrer">
              https://www.cdc.gov/dpdx/monthlycasestudies/2020/case514.html
            </a>
          </li>
        </ul>

        <h3>WHO and Global Burden</h3>
        <ul class="citations-list">
          <li>
            World Health Organization (WHO). <em>Trypanosomiasis, human African (sleeping sickness) – Fact sheet.</em>
            <a href="https://www.who.int/news-room/fact-sheets/detail/trypanosomiasis-human-african-(sleeping-sickness)" target="_blank" rel="noreferrer">
              https://www.who.int/news-room/fact-sheets/detail/trypanosomiasis-human-african-(sleeping-sickness)
            </a>
          </li>
        </ul>

        <h3>Ecology &amp; Climate (vector and environment)</h3>
        <ul class="citations-list">
          <li>
            Messina JP et al. <em>Climate Change and Risk Projection: Dynamic Spatial Models of Tsetse and Trypanosomiasis.</em>
            PLoS Neglected Tropical Diseases, 2012.
          </li>
          <li>
            Lord JS et al. <em>Climate change and African trypanosomiasis vector populations.</em>
            Parasites &amp; Vectors, 2018.
          </li>
        </ul>
      </div>
    </section>
  </div>
</main>

<footer>
  Educational tool for parasitology – African trypanosomiasis (sleeping sickness).
</footer>

<script>
  /* ---------- LIFE CYCLE STAGES ---------- */
  const stages = [
    {
      id: "1",
      order: 1,
      name: "Metacyclic trypomastigote (infective form)",
      short: "Metacyclic trypomastigote",
      host: "Tsetse fly (Glossina spp.) → Mammalian host",
      location: "Salivary glands of tsetse fly; injected into skin and bloodstream during bite",
      type: "Infective stage for humans",
      keyPoints: [
        "Injected during the tsetse fly blood meal on a mammalian host.",
        "Parasites enter skin tissue, then move into the lymphatic system and bloodstream.",
        "Marks the beginning of human infection in the life cycle."
      ],
      notes: [
        "Can be associated with a local sore (trypanosomal chancre) at the bite site.",
        "First step toward systemic disease and later central nervous system involvement."
      ],
      flow: "Tsetse salivary gland → human skin → lymphatic system → bloodstream."
    },
    {
      id: "2",
      order: 2,
      name: "Bloodstream trypomastigote (slender & stumpy forms)",
      short: "Bloodstream trypomastigote",
      host: "Mammalian host (human or animal reservoir)",
      location: "Blood and other body fluids, including lymph and spinal fluid",
      type: "Diagnostic & proliferative stage in humans",
      keyPoints: [
        "Metacyclic forms transform into bloodstream trypomastigotes.",
        "Parasites multiply by binary fission in blood and other body fluids.",
        "All stages in humans are extracellular."
      ],
      notes: [
        "Includes replicating slender forms and non-dividing, transmission-competent stumpy forms.",
        "This is the form detected on blood smears for diagnosis; later, parasites can invade the CNS and cause neurologic symptoms."
      ],
      flow: "Bloodstream and body fluids → ingested by tsetse fly during blood meal."
    },
    {
      id: "3",
      order: 3,
      name: "Procyclic trypomastigote (midgut form)",
      short: "Procyclic trypomastigote",
      host: "Tsetse fly",
      location: "Midgut of the tsetse fly",
      type: "Proliferative vector stage",
      keyPoints: [
        "Tsetse flies become infected when they ingest bloodstream trypomastigotes.",
        "In the fly midgut, parasites transform into procyclic trypomastigotes.",
        "Procyclic forms multiply by binary fission before leaving the midgut."
      ],
      notes: [
        "Not infective for mammals; part of the fly-side cycle.",
        "Successful midgut colonization is required for further development."
      ],
      flow: "Ingested bloodstream trypomastigotes → procyclic forms in midgut."
    },
    {
      id: "4",
      order: 4,
      name: "Epimastigote (salivary gland form)",
      short: "Epimastigote",
      host: "Tsetse fly",
      location: "Proventriculus and salivary glands of the fly",
      type: "Replicating stage in salivary glands",
      keyPoints: [
        "Procyclic forms leave the midgut and transform into epimastigotes.",
        "Epimastigotes migrate to the salivary glands.",
        "They continue to multiply by binary fission in the glands."
      ],
      notes: [
        "Bridges midgut replication and the final infective stage.",
        "Part of a roughly 3-week developmental cycle in the fly."
      ],
      flow: "Midgut → proventriculus → salivary glands."
    },
    {
      id: "5",
      order: 5,
      name: "Metacyclic trypomastigote (ready for next host)",
      short: "Metacyclic trypomastigote (mature)",
      host: "Tsetse fly → new mammalian host",
      location: "Salivary glands of an infected tsetse fly",
      type: "Final vector stage, infective to mammals",
      keyPoints: [
        "Epimastigotes differentiate into metacyclic trypomastigotes.",
        "These metacyclic forms are infective for mammals.",
        "They are injected during the fly’s next blood meal."
      ],
      notes: [
        "A single infected fly can transmit to multiple hosts over its life.",
        "Maintains transmission in rural areas with humans and animal reservoirs."
      ],
      flow: "Epimastigotes in salivary glands → metacyclic forms → new mammalian host."
    }
  ];

  /* ---------- QUIZ QUESTIONS ---------- */
  const quizQuestions = [
    {
      question: "What parasite causes human African trypanosomiasis (sleeping sickness)?",
      extra: "",
      options: [
        "Trypanosoma brucei",
        "Trypanosoma cruzi",
        "Plasmodium falciparum",
        "Leishmania donovani"
      ],
      correctIndex: 0,
      explanation: "Sleeping sickness is caused by Trypanosoma brucei parasites."
    },
    {
      question: "What insect vector transmits African trypanosomes to humans?",
      extra: "",
      options: [
        "Tsetse fly (Glossina spp.)",
        "Anopheles mosquito",
        "Sand fly",
        "Hard tick"
      ],
      correctIndex: 0,
      explanation: "The tsetse fly is the vector for human African trypanosomiasis."
    },
    {
      question: "Where are tsetse flies that spread sleeping sickness found?",
      extra: "",
      options: [
        "Rural areas of sub-Saharan Africa",
        "Every continent worldwide",
        "South America only",
        "Southeast Asia only"
      ],
      correctIndex: 0,
      explanation: "Sleeping sickness transmission occurs in rural parts of sub-Saharan Africa where tsetse flies live."
    },
    {
      question: "Which subspecies is typically associated with West and Central African sleeping sickness?",
      extra: "",
      options: [
        "Trypanosoma brucei gambiense",
        "Trypanosoma brucei rhodesiense",
        "Trypanosoma cruzi",
        "Trypanosoma brucei brucei"
      ],
      correctIndex: 0,
      explanation: "T. b. gambiense causes most chronic cases in West and Central Africa."
    },
    {
      question: "Which subspecies usually causes a faster-progressing East African disease?",
      extra: "",
      options: [
        "Trypanosoma brucei rhodesiense",
        "Trypanosoma brucei gambiense",
        "Plasmodium vivax",
        "Leishmania tropica"
      ],
      correctIndex: 0,
      explanation: "T. b. rhodesiense typically produces an acute, rapidly progressing illness in East and Southeast Africa."
    },
    {
      question: "Which bloodstream form is transmission-competent for the tsetse fly?",
      extra: "",
      options: [
        "Stumpy form",
        "Slender form",
        "Both equally",
        "Neither form"
      ],
      correctIndex: 0,
      explanation: "The non-dividing stumpy form is adapted to survive in the tsetse midgut and is transmission-competent."
    },
    {
      question: "How many main clinical stages are recognized in human African trypanosomiasis?",
      extra: "",
      options: [
        "Two: early hemolymphatic stage and CNS (meningoencephalitic) stage",
        "One single acute stage only",
        "Three including a liver-only stage",
        "Four distinct chronic stages"
      ],
      correctIndex: 0,
      explanation: "Two main stages are described: early blood/lymph disease and later central nervous system disease."
    },
    {
      question: "Which of the following is a typical early (first-stage) manifestation?",
      extra: "",
      options: [
        "Fever, headache, and sometimes a sore at the tsetse bite site",
        "Sudden total blindness only",
        "Chronic kidney failure without other symptoms",
        "Isolated toe pain"
      ],
      correctIndex: 0,
      explanation: "Early disease often includes fever, headache, and a chancre at the bite site."
    },
    {
      question: "Which symptom reflects central nervous system involvement in later-stage disease?",
      extra: "",
      options: [
        "Disturbance of the sleep–wake cycle",
        "Mild hand rash only",
        "Toothache only",
        "Short-term ankle sprain"
      ],
      correctIndex: 0,
      explanation: "Second-stage disease often includes disruption of the sleep–wake cycle."
    },
    {
      question: "In which morphologic form is T. brucei typically seen on blood smear?",
      extra: "",
      options: [
        "Extracellular trypomastigote with undulating membrane",
        "Intracellular amastigote in red blood cells",
        "Ring forms inside hepatocytes",
        "Egg with an operculum"
      ],
      correctIndex: 0,
      explanation: "On smear it appears as an extracellular trypomastigote with a flagellum and undulating membrane."
    }
  ];

  /* ---------- GAME: T. BRUCEI TRAIL ---------- */
  const gameStates = [
    {
      id: "start",
      title: "Salivary glands of a tsetse fly",
      host: "Tsetse fly",
      stageLabel: "Metacyclic trypomastigote",
      progressLabel: "0 / 5 milestones",
      text:
        "You are a metacyclic trypomastigote waiting in the salivary glands of a tsetse fly. " +
        "Your only chance to infect a mammal is when the fly takes a blood meal.",
      options: [
        {
          label: "The fly feeds on a human in rural sub-Saharan Africa.",
          next: "human-skin",
          outcome: "You are injected into human skin with the fly’s saliva. Infection begins."
        },
        {
          label: "The fly avoids humans and never feeds again.",
          next: "dead",
          outcome: "Without a blood meal on a mammal, you never leave the fly. The life cycle ends here."
        }
      ]
    },
    {
      id: "human-skin",
      title: "From skin to bloodstream",
      host: "Human",
      stageLabel: "Early infection near bite site",
      progressLabel: "1 / 5 milestones",
      text:
        "You have been deposited into human skin at the bite site. To establish infection, " +
        "you must leave the skin and move deeper into the host.",
      options: [
        {
          label: "Enter lymphatic vessels and then the bloodstream.",
          next: "blood-slender",
          outcome: "You enter lymph and blood and begin transforming into a bloodstream trypomastigote."
        },
        {
          label: "Stay local in the skin and avoid moving.",
          next: "dead",
          outcome: "Staying put means you never establish systemic infection. The immune system clears you."
        }
      ]
    },
    {
      id: "blood-slender",
      title: "Slender bloodstream form",
      host: "Human",
      stageLabel: "Slender bloodstream trypomastigote",
      progressLabel: "2 / 5 milestones",
      text:
        "You are now a slender bloodstream trypomastigote. You multiply and increase parasitemia, " +
        "but if your numbers get too high, you must prepare for transmission back to a fly.",
      options: [
        {
          label: "Keep multiplying as slender forms only.",
          next: "overrun",
          outcome: "You expand rapidly, but without producing stumpy forms there is no transmission-ready stage."
        },
        {
          label: "Differentiate some progeny into stumpy forms.",
          next: "blood-stumpy",
          outcome: "You generate stumpy forms adapted to survive in a tsetse fly midgut."
        }
      ]
    },
    {
      id: "overrun",
      title: "No stumpy forms produced",
      host: "Human",
      stageLabel: "Slender trypomastigotes only",
      progressLabel: "2 / 5 milestones",
      text:
        "You multiplied aggressively as slender forms but failed to generate stumpy forms. " +
        "The host becomes very ill, but you are not prepared for transmission to a fly.",
      options: [
        {
          label: "Restart the life cycle and try to balance replication and transmission.",
          next: "start",
          outcome: "You get another chance at T. brucei Trail."
        }
      ]
    },
    {
      id: "blood-stumpy",
      title: "Stumpy form waiting for a tsetse fly",
      host: "Human",
      stageLabel: "Stumpy bloodstream trypomastigote",
      progressLabel: "3 / 5 milestones",
      text:
        "You are now in the non-dividing stumpy form, circulating in human blood and ready to survive " +
        "conditions in the tsetse fly midgut if a fly feeds on this host.",
      options: [
        {
          label: "A tsetse fly bites this infected human and takes a blood meal.",
          next: "fly-midgut",
          outcome: "You are ingested with the blood and enter the fly’s midgut."
        },
        {
          label: "No flies feed; the infection runs its course in this host.",
          next: "dead",
          outcome: "Without a fly vector, the life cycle stops in the mammal."
        }
      ]
    },
    {
      id: "fly-midgut",
      title: "Procyclic trypomastigote in the midgut",
      host: "Tsetse fly",
      stageLabel: "Procyclic trypomastigote",
      progressLabel: "4 / 5 milestones",
      text:
        "Inside the tsetse midgut, you must transform into a procyclic trypomastigote and multiply " +
        "before migrating toward the salivary glands.",
      options: [
        {
          label: "Adapt to the midgut, transform, and multiply as a procyclic trypomastigote.",
          next: "fly-epimastigote",
          outcome: "You establish infection in the midgut and begin moving toward the salivary glands."
        },
        {
          label: "Remain in stumpy bloodstream form and fail to adapt.",
          next: "dead",
          outcome: "Forms that fail to adapt to the fly midgut do not complete development."
        }
      ]
    },
    {
      id: "fly-epimastigote",
      title: "Epimastigote in salivary glands",
      host: "Tsetse fly",
      stageLabel: "Epimastigote",
      progressLabel: "4.5 / 5 milestones",
      text:
        "You have moved from the midgut to the proventriculus and then to the salivary glands as an epimastigote, " +
        "multiplying by binary fission.",
      options: [
        {
          label: "Differentiate into metacyclic trypomastigotes ready to infect a new mammal.",
          next: "complete",
          outcome: "You successfully become metacyclic trypomastigotes again, ready for the next bite."
        },
        {
          label: "Stay as an epimastigote and never complete development.",
          next: "dead",
          outcome: "Without differentiating into metacyclic forms, you cannot infect another mammalian host."
        }
      ]
    },
    {
      id: "complete",
      title: "Life cycle complete",
      host: "Tsetse fly",
      stageLabel: "Metacyclic trypomastigote",
      progressLabel: "5 / 5 milestones",
      text:
        "You are back in the salivary glands as a metacyclic trypomastigote, ready to infect another mammalian host. " +
        "You have successfully completed the Trypanosoma brucei life cycle.",
      options: [
        {
          label: "Play the T. brucei Trail again from the beginning.",
          next: "start",
          outcome: "You restart as a new metacyclic trypomastigote."
        }
      ]
    },
    {
      id: "dead",
      title: "Life cycle broken",
      host: "—",
      stageLabel: "Cycle ended",
      progressLabel: "Stopped",
      text:
        "A key step in the life cycle failed. In nature, many parasites never complete the full cycle.",
      options: [
        {
          label: "Restart T. brucei Trail and attempt the life cycle again.",
          next: "start",
          outcome: "You get another shot at being T. brucei."
        }
      ]
    }
  ];

  /* ---------- DOM HOOKS ---------- */
  const stageListEl = document.getElementById("stage-list");
  const stageTitleEl = document.getElementById("stage-title");
  const stagePillsEl = document.getElementById("stage-pills");
  const stageHostEl = document.getElementById("stage-host");
  const stageLocationEl = document.getElementById("stage-location");
  const stageKeypointsEl = document.getElementById("stage-keypoints");
  const stageNotesEl = document.getElementById("stage-notes");
  const stageFlowEl = document.getElementById("stage-flow");
  const bsFormsSection = document.getElementById("bs-forms-section");

  const panelExplore = document.getElementById("panel-explore");
  const panelQuiz = document.getElementById("panel-quiz");
  const panelGame = document.getElementById("panel-game");
  const panelWhy = document.getElementById("panel-why");
  const panelEcology = document.getElementById("panel-ecology");
  const panelCitations = document.getElementById("panel-citations");

  const modeExploreBtn = document.getElementById("mode-explore");
  const modeQuizBtn = document.getElementById("mode-quiz");
  const modeGameBtn = document.getElementById("mode-game");
  const modeWhyBtn = document.getElementById("mode-why");
  const modeEcologyBtn = document.getElementById("mode-ecology");
  const modeCitationsBtn = document.getElementById("mode-citations");

  const quizQuestionText = document.getElementById("quiz-question-text");
  const quizQuestionExtra = document.getElementById("quiz-question-extra");
  const quizOptionsEl = document.getElementById("quiz-options");
  const quizFeedbackEl = document.getElementById("quiz-feedback");
  const quizNextBtn = document.getElementById("quiz-next");
  const quizMetaEl = document.getElementById("quiz-meta");

  const gameStatusEl = document.getElementById("game-status");
  const gameStateTitleEl = document.getElementById("game-state-title");
  const gameStateTextEl = document.getElementById("game-state-text");
  const gameOptionsEl = document.getElementById("game-options");
  const gameOutcomeEl = document.getElementById("game-outcome");
  const gameMetaEl = document.getElementById("game-meta");
  const gameResetBtn = document.getElementById("game-reset");

  const STORAGE_KEY = "tbruceiQuizStats_v1";

  let selectedStageId = null;
  let quizState = { index: 0, correct: 0, total: 0, locked: false };
  let currentGameStateId = "start";
  let gameSteps = 0;
  let gameRuns = 0;
  let gameCompletedRuns = 0;

  /* ---------- QUIZ STORAGE ---------- */
  function loadQuizStatsFromStorage() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const data = JSON.parse(raw);
      if (
        typeof data.correct === "number" &&
        typeof data.total === "number" &&
        data.correct >= 0 &&
        data.total >= 0
      ) {
        quizState.correct = data.correct;
        quizState.total = data.total;
      }
    } catch (e) {
      // ignore
    }
  }

  function saveQuizStatsToStorage() {
    try {
      const payload = {
        correct: quizState.correct,
        total: quizState.total
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    } catch (e) {
      // ignore
    }
  }

  /* ---------- RENDER TIMELINE ---------- */
  function renderStageList() {
    stageListEl.innerHTML = "";
    stages
      .slice()
      .sort((a, b) => a.order - b.order)
      .forEach(stage => {
        const item = document.createElement("div");
        item.className = "stage-item";
        item.dataset.id = stage.id;

        const num = document.createElement("div");
        num.className = "stage-number";
        num.textContent = stage.order;

        const text = document.createElement("div");
        text.className = "stage-text";
        text.innerHTML = `<strong>${stage.short}</strong>${stage.host}`;

        item.appendChild(num);
        item.appendChild(text);

        item.addEventListener("click", () => {
          selectStage(stage.id);
        });

        stageListEl.appendChild(item);
      });
  }

  function selectStage(stageId) {
    selectedStageId = stageId;
    const stage = stages.find(s => s.id === stageId);
    if (!stage) return;

    document.querySelectorAll(".stage-item").forEach(el => {
      el.classList.toggle("active", el.dataset.id === stageId);
    });

    stageTitleEl.textContent = stage.name;

    stagePillsEl.innerHTML = "";
    const pill1 = document.createElement("div");
    pill1.className = "pill";
    pill1.textContent = stage.type;
    stagePillsEl.appendChild(pill1);

    const pill2 = document.createElement("div");
    pill2.className = "pill";
    pill2.textContent = `Stage ${stage.order}`;
    stagePillsEl.appendChild(pill2);

    stageHostEl.textContent = stage.host;
    stageLocationEl.textContent = stage.location;

    stageKeypointsEl.innerHTML = "";
    stage.keyPoints.forEach(pt => {
      const li = document.createElement("li");
      li.textContent = pt;
      stageKeypointsEl.appendChild(li);
    });

    stageNotesEl.innerHTML = "";
    stage.notes.forEach(pt => {
      const li = document.createElement("li");
      li.textContent = pt;
      stageNotesEl.appendChild(li);
    });

    stageFlowEl.textContent = stage.flow || "";

    if (stage.id === "2") {
      bsFormsSection.style.display = "block";
    } else {
      bsFormsSection.style.display = "none";
    }
  }

  /* ---------- MODE SWITCHING ---------- */
  function hideAllPanels() {
    panelExplore.style.display = "none";
    panelQuiz.style.display = "none";
    panelGame.style.display = "none";
    panelWhy.style.display = "none";
    panelEcology.style.display = "none";
    panelCitations.style.display = "none";

    modeExploreBtn.classList.remove("active");
    modeQuizBtn.classList.remove("active");
    modeGameBtn.classList.remove("active");
    modeWhyBtn.classList.remove("active");
    modeEcologyBtn.classList.remove("active");
    modeCitationsBtn.classList.remove("active");
  }

  function setMode(mode) {
    hideAllPanels();
    if (mode === "explore") {
      panelExplore.style.display = "block";
      modeExploreBtn.classList.add("active");
    } else if (mode === "quiz") {
      panelQuiz.style.display = "block";
      modeQuizBtn.classList.add("active");
      loadQuizQuestion();
    } else if (mode === "game") {
      panelGame.style.display = "block";
      modeGameBtn.classList.add("active");
      renderGameState(currentGameStateId);
    } else if (mode === "why") {
      panelWhy.style.display = "block";
      modeWhyBtn.classList.add("active");
    } else if (mode === "ecology") {
      panelEcology.style.display = "block";
      modeEcologyBtn.classList.add("active");
    } else if (mode === "citations") {
      panelCitations.style.display = "block";
      modeCitationsBtn.classList.add("active");
    }
  }

  modeExploreBtn.addEventListener("click", () => setMode("explore"));
  modeQuizBtn.addEventListener("click", () => setMode("quiz"));
  modeGameBtn.addEventListener("click", () => setMode("game"));
  modeWhyBtn.addEventListener("click", () => setMode("why"));
  modeEcologyBtn.addEventListener("click", () => setMode("ecology"));
  modeCitationsBtn.addEventListener("click", () => setMode("citations"));

  /* ---------- QUIZ LOGIC ---------- */
  function loadQuizQuestion() {
    quizState.locked = false;
    quizFeedbackEl.textContent = "";
    quizFeedbackEl.className = "quiz-feedback";

    const q = quizQuestions[quizState.index];
    quizQuestionText.textContent = q.question;
    quizQuestionExtra.textContent = q.extra || "";
    quizOptionsEl.innerHTML = "";

    q.options.forEach((opt, idx) => {
      const btn = document.createElement("button");
      btn.className = "quiz-option";
      btn.textContent = opt;
      btn.addEventListener("click", () =>
        handleQuizAnswer(btn, idx, q.correctIndex, q.explanation)
      );
      quizOptionsEl.appendChild(btn);
    });

    updateQuizMeta();
  }

  function handleQuizAnswer(button, chosenIndex, correctIndex, explanation) {
    if (quizState.locked) return;
    quizState.locked = true;
    quizState.total += 1;

    const allBtns = quizOptionsEl.querySelectorAll(".quiz-option");
    allBtns.forEach(b => (b.disabled = true));

    if (chosenIndex === correctIndex) {
      button.classList.add("correct");
      quizFeedbackEl.textContent = "Correct. " + explanation;
      quizFeedbackEl.classList.add("correct");
      quizState.correct += 1;
    } else {
      button.classList.add("incorrect");
      quizFeedbackEl.textContent = "Not quite. " + explanation;
      quizFeedbackEl.classList.add("incorrect");
      allBtns.forEach((b, idx) => {
        if (idx === correctIndex) b.classList.add("correct");
      });
    }

    saveQuizStatsToStorage();
    updateQuizMeta();
  }

  function updateQuizMeta() {
    const qNumber = quizState.index + 1;
    quizMetaEl.textContent =
      "Question " +
      qNumber +
      " of " +
      quizQuestions.length +
      " • Cumulative score: " +
      quizState.correct +
      " / " +
      quizState.total;
  }

  quizNextBtn.addEventListener("click", () => {
    quizState.index = (quizState.index + 1) % quizQuestions.length;
    loadQuizQuestion();
  });

  /* ---------- GAME LOGIC ---------- */
  function getGameState(id) {
    return gameStates.find(s => s.id === id) || gameStates[0];
  }

  function renderGameState(id) {
    const state = getGameState(id);
    currentGameStateId = state.id;

    gameStateTitleEl.innerHTML = state.title;
    gameStateTextEl.innerHTML = state.text;
    gameOutcomeEl.textContent = "";
    gameOptionsEl.innerHTML = "";

    state.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.textContent = opt.label;
      btn.style.width = "100%";
      btn.addEventListener("click", () => {
        gameSteps += 1;
        currentGameStateId = opt.next;
        gameOutcomeEl.textContent = opt.outcome;

        // track completed runs
        if (opt.next === "complete") {
          gameCompletedRuns += 1;
        }
        renderGameState(opt.next);
      });
      gameOptionsEl.appendChild(btn);
    });

    gameStatusEl.textContent =
      "Host: " +
      state.host +
      " • Stage: " +
      state.stageLabel +
      " • Milestones: " +
      state.progressLabel;

    gameMetaEl.textContent =
      "Steps this run: " +
      gameSteps +
      " • Completed cycles: " +
      gameCompletedRuns +
      " • Runs started: " +
      gameRuns;
  }

  gameResetBtn.addEventListener("click", () => {
    currentGameStateId = "start";
    gameSteps = 0;
    gameRuns += 1;
    renderGameState(currentGameStateId);
  });

  /* ---------- INIT ---------- */
  loadQuizStatsFromStorage();
  renderStageList();
  if (stages.length > 0) {
    selectStage(stages[0].id);
  }
  loadQuizQuestion();
  gameRuns = 1;
  renderGameState(currentGameStateId);
</script>
</body>
</html>
